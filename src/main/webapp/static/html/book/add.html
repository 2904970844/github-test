<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>添加书籍</title>
    <link rel="stylesheet" href="/static/lib/layui-v2.5.5/css/layui.css" media="all">
</head>
<body class="layui-bg-gray">
<div class="layui-container">
    <div class="layui-row">
        <div class="layui-card">
            <div class="layui-card-header">添加书籍</div>
            <div class="layui-card-body">
                <form class="layui-form" action="" method="post">
                    <div class="layui-form-item layui-form-pane">
                        <label class="layui-form-label">标题</label>
                        <div class="layui-input-block">
                            <input type="text" name="title" placeholder="请输入标题" required class="layui-input" lay-verify="required">
                        </div>
                    </div>
                    <div class="layui-form-item layui-form-pane">
                        <label class="layui-form-label">分类</label>
                        <div class="layui-input-block">
                                <select name="category" lay-filter="category" id="select">
                                    <option value="0">写作</option>
                                    <option value="1">阅读</option>
                                </select>
                        </div>
                    </div>
                    <div class="layui-form-item layui-form-pane">
                        <label class="layui-form-label">作者</label>
                        <div class="layui-input-block">
                            <select name="author" lay-filter="author" id="select1">
                                <option value="0">写作</option>
                                <option value="1">阅读</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-form-item layui-form-pane layui-form-text">
                        <label class="layui-form-label">概述</label>
                        <div class="layui-input-block">
                            <textarea name="summary" required lay-verify="required" placeholder="请输入" class="layui-textarea"></textarea>
                        </div>
                    </div>
                    <div>
                        <div class="layui-input-block">
                            <button class="layui-btn" lay-submit lay-filter="*">立即提交</button>
                            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</body>
<script src="/static/lib/layui-v2.5.5/layui.all.js"></script>
<script>
    layui.use(['form','layer'], function() {
        var form = layui.form,
        layer=layui.layer;
        var $=layui.$;
            $("#select").empty();
            $.ajax({
                type:'post',
                url:'/category/select',
                success:function (msg) {
                    var data = msg.data
                    var str="<option value='0'>请选择章节</option>";
                    for (var i=0;i<data.length;i++){
                        str+="<option value='"+data[i].id+"'>"+data[i].test+"</option>";
                    }
                    $("#select").html(str);
                    form.render('select');
                }
            })
        $.ajax({
                type:'get',
                url:'/users/select',
                success:function (msg) {
                    var data = msg.data
                    var str="<option value='0'>请选择作者</option>";
                    for (var i=0;i<data.length;i++){
                        str+="<option value='"+data[i].id+"'>"+data[i].test+"</option>";
                    }
                    $("#select1").html(str);
                    form.render('select');
                }
            })
        form.on('submit(*)',function (data) {
            console.info()
            if (data.field.category==0){
                layer.msg("请选择分类");
                return false
            }
            if (data.field.author==0){
                layer.msg("请选择作者");
                return false
            }
            var date = JSON.stringify(data.field).replace( new RegExp( '":"' , "g" ),"=").replace( new RegExp('","', "g" ),"&").replace('{"',"?").replace('"}',"");
            console.info(date)
            $.ajax({
                url:"/books/book"+date,
                type:"PUT",
                data:data.field,
                success:function(result){
                    if (result.code=="0000"){
                        parent.layui.table.reload('demo');
                        parent.layer.close(parent.layer.getFrameIndex(window.name));
                    }
                }
            });

            return false;
        })
    })
</script>
</body>
</html>