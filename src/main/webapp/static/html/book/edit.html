<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>添加书籍</title>
    <link rel="stylesheet" href="/static/lib/layui-v2.5.5/css/layui.css" media="all">
</head>
<body class="layui-bg-gray">
<div class="layui-container">
    <div class="layui-row">
        <div class="layui-card">
            <div class="layui-card-header">添加书籍</div>
            <div class="layui-card-body">
                <form class="layui-form" action="" method="post">
                    <div class="layui-form-item layui-form-pane">
                        <label class="layui-form-label">标题</label>
                        <div class="layui-input-block">
                            <input type="text" name="title" placeholder="请输入标题" required class="layui-input" lay-verify="required">
                            <input name="id" type="text" style="display: none">
                        </div>
                    </div>
                    <div class="layui-form-item layui-form-pane">
                        <label class="layui-form-label">分类</label>
                        <div class="layui-input-block">
                                <select name="categoryId" lay-filter="aihao" id="select">
                                    <option value="0">写作</option>
                                    <option value="1">阅读</option>
                                </select>
                        </div>
                    </div>
                    <div class="layui-form-item layui-form-pane">
                        <label class="layui-form-label">作者</label>
                        <div class="layui-input-block">
                            <select name="author" lay-filter="aihao" id="select1">
                                <option value="0">写作</option>
                                <option value="1">阅读</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-form-item layui-form-pane layui-form-text">
                        <label class="layui-form-label">概述</label>
                        <div class="layui-input-block">
                            <textarea name="summary" required lay-verify="required" placeholder="请输入" class="layui-textarea"></textarea>
                        </div>
                    </div>
                    <div>
                        <div class="layui-input-block">
                            <button class="layui-btn" lay-submit lay-filter="*">立即提交</button>
                            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</body>
<script src="/static/lib/layui-v2.5.5/layui.all.js"></script>
<script>
    layui.use(['form','layer'], function() {
        var id = window.location.href.split("=")[1]
        var form = layui.form,
        layer=layui.layer;
        // console.info(i)
        var $=layui.$;
        var demo=parent.layui.table.cache.demo;
        /*        console.info(demo[0])
                console.info(parent.layer)*/
        var n;
        var id1=layui.sessionData("book/edit.html")["book-id"];
        for(n in demo){
            if (demo[n].id==id1)break;
        }
        $("[name='title']").val(demo[n].title)
        $("[name='summary']").val(demo[n].summary)
        $("[name='id']").val(demo[n].id)

        $("#select").empty();
            $.ajax({
                type:'post',
                url:'/category/select',
                success:function (msg) {
                    var data = msg.data
                    var str="";
                    for (var i=0;i<data.length;i++){
                        if (data[i].id==demo[n].categoryId){
                            str+="<option selected value='"+data[i].id+"'>"+data[i].test+"</option>";
                        }
                        str+="<option value='"+data[i].id+"'>"+data[i].test+"</option>";
                    }
                    $("#select").html(str);
                    form.render('select');
                }
            })
        $.ajax({
                type:'get',
                url:'/users/select',
                success:function (msg) {
                    var data = msg.data
                    var str="";
                    for (var i=0;i<data.length;i++){
                        if (data[i].id==demo[n].author){
                            str+="<option selected value='"+data[i].id+"'>"+data[i].test+"</option>";
                        }
                        str+="<option value='"+data[i].id+"'>"+data[i].test+"</option>";
                    }
                    $("#select1").html(str);
                    form.render('select');
                }
            })
        form.on('submit(*)',function (data) {
            // console.info(data.field)
            $.ajax({
                url:"/books",
                type:"post",
                data:data.field,
                success:function(result){
                    if (result.code=="0000"){
                        parent.layui.table.reload('demo');
                        parent.layer.close(parent.layer.getFrameIndex(window.name));
                    }
                }
            });

            return false;
        })
    })
</script>
</body>
</html>